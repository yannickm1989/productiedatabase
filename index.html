<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Productiedatabase</title>

<style>
body{
    font-family:Arial;
    background:#f5f5f5;
    padding:20px;
}
.app{
    max-width:450px;
    margin:auto;
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
.title-bar{
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#28a745;
    color:white;
    padding:10px;
    border-radius:8px;
    margin-bottom:15px;
}
.title-bar img{
    position:absolute;
    left:10px;
    height:40px;
}
.tab-buttons{
    display:flex;
    gap:10px;
    margin-bottom:15px;
}
.tab-buttons button{
    flex:1;
    background:#e0e0e0;
    border:none;
    padding:8px;
    border-radius:8px;
    cursor:pointer;
}
.tab-buttons button.active{
    background:#28a745;
    color:white;
    font-weight:bold;
}
label{
    font-weight:bold;
    display:block;
    margin-top:8px;
}
input{
    width:100%;
    padding:7px;
    margin-top:3px;
    border:1px solid #ccc;
    border-radius:4px;
}
button.main{
    margin-top:15px;
    width:100%;
    padding:10px;
    font-size:16px;
    background:#28a745;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
.scan-btn{
    margin-top:10px;
    width:100%;
    padding:8px;
    font-size:14px;
    background:#007bff;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
.result-card{
    border:1px solid #ccc;
    border-radius:8px;
    padding:10px;
    margin-top:10px;
}
.omschrijving{
    text-align:center;
    font-weight:bold;
    font-size:16px;
    margin-bottom:8px;
}
hr{margin:6px 0;}
</style>
</head>

<body>
<div class="app">

<div class="title-bar">
    <img src="ym.png" alt="YM">
    <h2>Productiedatabase</h2>
</div>

<div class="tab-buttons">
    <button id="tabInvoer" class="active">Invoer</button>
    <button id="tabZoek">Opzoeken</button>
</div>

<div id="invoerTab"></div>
<div id="zoekTab" style="display:none"></div>

</div>

<!-- OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyBtV-MNtSxf7mJ5RM5dS_5MeRdpcOMy6a4",
 authDomain:"productiedatabase.firebaseapp.com",
 projectId:"productiedatabase",
 storageBucket:"productiedatabase.firebasestorage.app",
 messagingSenderId:"269980901692",
 appId:"1:269980901692:web:642b70f033694811817e39"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const colRef=collection(db,"Productiedatabase");

let editId=null;

const fields=[
 {k:"artikelnummer",l:"Artikelnummer"},
 {k:"omschrijving",l:"Omschrijving"},
 {k:"blikinhoud",l:"Blikinhoud"},
 {k:"deksel",l:"Deksel"},
 {k:"blik",l:"Blik"},
 {k:"verpakker1",l:"Verpakker 1"},
 {k:"verpakker2",l:"Verpakker 2"},
 {k:"hoeveelPerPak",l:"Hoeveel per pak"},
 {k:"secundaireFolie",l:"Secundaire folie"},
 {k:"tertiaireFolie",l:"Tertiaire folie"},
 {k:"tertiaireTopfolie",l:"Tertiaire topfolie"},
 {k:"pallet",l:"Pallet"},
 {k:"tussenlegger",l:"Tussenlegger"},
 {k:"plaatsingTussenleggers",l:"Plaatsing tussenleggers"},
 {k:"stapelprogramma",l:"Stapelprogramma"},
 {k:"aantalLagen",l:"Aantal lagen"},
 {k:"hoeveelPerLaag",l:"Hoeveel per laag"}
];

// invoer velden
const invoer=document.getElementById("invoerTab");

invoer.innerHTML+=`
<input type="file" id="scanInput" accept="image/*" capture="environment" style="display:none">
<button class="scan-btn" onclick="startScan()">üì∑ Scan productieblad</button>
<button class="scan-btn" onclick="clearFields()">‚úçÔ∏è Handmatig invoeren</button>
`;

fields.forEach(f=>{
 invoer.innerHTML+=`<label>${f.l}</label><input id="${f.k}">`;
});

invoer.innerHTML+=`<button class="main" onclick="save()">Opslaan</button>`;

// zoeken
document.getElementById("zoekTab").innerHTML=`
<label>Zoek op artikelnummer of omschrijving</label>
<input id="zoek">
<button class="main" onclick="zoek()">Zoek</button>
<div id="result"></div>`;

// OCR scan
window.startScan=()=>{
 document.getElementById("scanInput").click();
};

document.getElementById("scanInput").addEventListener("change", async e=>{
 const file=e.target.files[0];
 if(!file) return;

 const { data:{ text } } = await Tesseract.recognize(file,"eng");
 const t=text.toUpperCase();

 function find(label){
  const i=t.indexOf(label);
  if(i===-1) return "";
  return t.substring(i+label.length, i+label.length+40)
          .split("\n")[0]
          .replace(/[:\-]/g,"")
          .trim();
 }

 const map={
  artikelnummer:find("ARTIKELNUMMER"),
  omschrijving:find("PRODUCT"),
  blikinhoud:find("INHOUD"),
  deksel:find("DEKSEL"),
  blik:find("BLIK"),
  verpakker1:find("VERPAKKER"),
  verpakker2:find("VERPAKKER 2"),
  hoeveelPerPak:find("AANTAL PER"),
  secundaireFolie:find("SECUNDAIRE"),
  tertiaireFolie:find("TERTIAIRE FOLIE"),
  tertiaireTopfolie:find("TOPFOLIE"),
  pallet:find("PALLET"),
  tussenlegger:find("TUSSENLEGGER"),
  plaatsingTussenleggers:find("PLAATSING"),
  stapelprogramma:find("STAPEL"),
  aantalLagen:find("LAGEN"),
  hoeveelPerLaag:find("PER LAAG")
 };

 for(const k in map){
  if(map[k] && document.getElementById(k)){
   document.getElementById(k).value=map[k];
  }
 }
});

// handmatig
window.clearFields=()=>{
 fields.forEach(f=>{
  const el=document.getElementById(f.k);
  if(el) el.value="";
 });
};

// save
window.save=async()=>{
 let data={};
 fields.forEach(f=>{
  data[f.k]=document.getElementById(f.k).value.trim();
 });
 if(editId) await updateDoc(doc(db,"Productiedatabase",editId),data);
 else await addDoc(colRef,data);

 fields.forEach(f=>document.getElementById(f.k).value="");
 alert("Opgeslagen");
};

// zoek
window.zoek=async()=>{
 const q=document.getElementById("zoek").value.trim().toUpperCase();
 const res=document.getElementById("result");
 res.innerHTML="";
 if(!q) return;

 const snap=await getDocs(colRef);
 snap.forEach(d=>{
  const data=d.data();
  if((data.artikelnummer||"").toUpperCase().includes(q) || (data.omschrijving||"").toUpperCase().includes(q)){
   let html=`<div class="result-card">`;
   if(data.omschrijving) html+=`<div class="omschrijving">${data.omschrijving}</div><hr>`;
   fields.forEach(f=>{
    if(f.k!=="omschrijving" && data[f.k]) html+=`<b>${f.l}:</b> ${data[f.k]}<br>`;
   });
   html+=`</div>`;
   res.innerHTML+=html;
  }
 });
};

// tabs
const tabInvoer=document.getElementById("tabInvoer");
const tabZoek=document.getElementById("tabZoek");
const invoerTab=document.getElementById("invoerTab");
const zoekTab=document.getElementById("zoekTab");

tabInvoer.onclick=()=>{
 tabInvoer.classList.add("active");
 tabZoek.classList.remove("active");
 invoerTab.style.display="block";
 zoekTab.style.display="none";
};
tabZoek.onclick=()=>{
 tabZoek.classList.add("active");
 tabInvoer.classList.remove("active");
 invoerTab.style.display="none";
 zoekTab.style.display="block";
};
</script>
</body>
</html>