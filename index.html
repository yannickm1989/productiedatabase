<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Productiedatabase</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBtV-MNtSxf7mJ5RM5dS_5MeRdpcOMy6a4",
  authDomain: "productiedatabase.firebaseapp.com",
  projectId: "productiedatabase",
  storageBucket: "productiedatabase.firebasestorage.app",
  messagingSenderId: "269980901692",
  appId: "1:269980901692:web:642b70f033694811817e39"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const colRef = collection(db, "Productiedatabase");

let editId = null;

const fields = [
  { key:"artikelnummer", label:"Artikelnummer" },
  { key:"omschrijving", label:"Omschrijving" },
  { key:"blikinhoud", label:"Blikinhoud" },
  { key:"deksel", label:"Deksel" },
  { key:"blik", label:"Blik" },
  { key:"verpakker1", label:"Verpakker 1" },
  { key:"verpakker2", label:"Verpakker 2" },
  { key:"tray", label:"Tray" },
  { key:"wrap", label:"Wrap" },
  { key:"hoeveelPerPak", label:"Hoeveel per pak" },
  { key:"hoeveelPerTray", label:"Hoeveel per tray/doos" },
  { key:"secundaireFolie", label:"Secundaire folie" },
  { key:"tertiaireFolie", label:"Tertiaire folie" },
  { key:"tertiaireTopfolie", label:"Tertiaire topfolie" },
  { key:"pallet", label:"Pallet" },
  { key:"tussenlegger", label:"Tussenlegger" },
  { key:"stapelprogramma", label:"Stapelprogramma" },
  { key:"aantalLagen", label:"Aantal lagen" },
  { key:"hoeveelPerLaag", label:"Hoeveel per laag" }
];

window.onload = () => {
  const container = document.getElementById("formFields");
  fields.forEach(f => {
    const input = document.createElement("input");
    input.id = f.key;
    input.placeholder = f.label;
    container.appendChild(input);
  });
};

window.saveArticle = async () => {
  let data = {};
  fields.forEach(f => {
    let val = document.getElementById(f.key).value.trim();
    if (f.key !== "omschrijving") val = val.toUpperCase();
    data[f.key] = val;
  });

  if (editId) {
    await updateDoc(doc(db,"Productiedatabase",editId), data);
    editId = null;
  } else {
    await addDoc(colRef, data);
  }

  fields.forEach(f => document.getElementById(f.key).value = "");
  alert("Opgeslagen");
};

window.searchArticle = async () => {
  const zoek = document.getElementById("zoek").value.trim().toUpperCase();
  const result = document.getElementById("result");
  result.innerHTML = "";

  const snap = await getDocs(colRef);
  snap.forEach(d => {
    const data = d.data();
    if (
      data.artikelnummer?.includes(zoek) ||
      data.omschrijving?.toUpperCase().includes(zoek)
    ) {
      let html = "<div class='card'>";

      if (data.omschrijving) {
        html += `<div class="omschrijving">${data.omschrijving}</div><hr>`;
      }

      fields.forEach(f => {
        if (f.key === "omschrijving") return;
        const val = data[f.key];
        if (val) {
          html += `<div><b>${f.label}:</b> ${val}</div>`;
        }
      });

      html += `
        <button onclick="editArticle('${d.id}')">Bewerken</button>
        <button onclick="deleteArticle('${d.id}')">Verwijderen</button>
      </div>`;
      result.innerHTML += html;
    }
  });
};

window.editArticle = async (id) => {
  const snap = await getDocs(colRef);
  snap.forEach(d => {
    if (d.id === id) {
      editId = id;
      const data = d.data();
      fields.forEach(f => {
        document.getElementById(f.key).value = data[f.key] || "";
      });
    }
  });
};

window.deleteArticle = async (id) => {
  if (confirm("Artikel verwijderen?")) {
    await deleteDoc(doc(db,"Productiedatabase",id));
    document.getElementById("result").innerHTML = "";
  }
};
</script>

<style>
body { font-family: Arial; margin:20px }
input { width:100%; margin-bottom:6px }
.card { border:1px solid #ccc; padding:10px; margin-bottom:10px }
.omschrijving { text-align:center; font-weight:bold; font-size:16px }
button { margin-top:8px; margin-right:6px }
</style>
</head>

<body>

<h2>Productiedatabase</h2>

<h3>Invoer</h3>
<div id="formFields"></div>
<button onclick="saveArticle()">Opslaan</button>

<hr>

<h3>Zoeken</h3>
<input id="zoek" placeholder="Zoek op artikelnummer of omschrijving">
<button onclick="searchArticle()">Zoek</button>

<div id="result"></div>

</body>
</html>
