<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Productiedatabase</title>

<style>
body{font-family:Arial;background:#f5f5f5;padding:20px}
.app{max-width:450px;margin:auto;background:white;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
.title-bar{position:relative;display:flex;align-items:center;justify-content:center;background:#28a745;color:white;padding:10px;border-radius:8px;margin-bottom:15px}
.title-bar img{position:absolute;left:10px;height:40px}
.tab-buttons{display:flex;gap:10px;margin-bottom:15px}
.tab-buttons button{flex:1;background:#e0e0e0;border:none;padding:8px;border-radius:8px;cursor:pointer}
.tab-buttons button.active{background:#28a745;color:white;font-weight:bold}
label{font-weight:bold;display:block;margin-top:8px}
input{width:100%;padding:7px;margin-top:3px;border:1px solid #ccc;border-radius:4px}
button.main{margin-top:15px;width:100%;padding:10px;font-size:16px;background:#28a745;color:white;border:none;border-radius:8px;cursor:pointer}
.result-card{border:1px solid #ccc;border-radius:8px;padding:10px;margin-top:10px}
.omschrijving{text-align:center;font-weight:bold;font-size:16px;margin-bottom:8px}
</style>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

<!-- OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>

<body>
<div class="app">
<div class="title-bar">
<img src="ym.png">
<h2>Productiedatabase</h2>
</div>

<div class="tab-buttons">
<button id="tabInvoer" class="active">Invoer</button>
<button id="tabZoek">Opzoeken</button>
</div>

<div id="invoerTab"></div>
<div id="zoekTab" style="display:none"></div>
</div>

<script>
// Firebase
const firebaseConfig={
 apiKey:"AIzaSyBtV-MNtSxf7mJ5RM5dS_5MeRdpcOMy6a4",
 authDomain:"productiedatabase.firebaseapp.com",
 projectId:"productiedatabase"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const colRef=db.collection("Productiedatabase");

let editId=null;

const fields=[
["artikelnummer","Artikelnummer"],
["omschrijving","Omschrijving"],
["blikinhoud","Blikinhoud"],
["deksel","Deksel"],
["blik","Blik"],
["verpakker1","Verpakker 1"],
["verpakker2","Verpakker 2"],
["tray","Tray"],
["wrap","Wrap"],
["hoeveelPerPak","Hoeveel per pak"],
["hoeveelPerTray","Hoeveel per tray/doos"],
["secundaireFolie","Secundaire folie"],
["tertiaireFolie","Tertiaire folie"],
["tertiaireTopfolie","Tertiaire topfolie"],
["pallet","Pallet"],
["tussenlegger","Tussenlegger"],
["plaatsingTussenleggers","Plaatsing tussenleggers"],
["stapelprogramma","Stapelprogramma"],
["aantalLagen","Aantal lagen"],
["hoeveelPerLaag","Hoeveel per laag"]
];

// UI bouwen
const invoer=document.getElementById("invoerTab");
fields.forEach(f=>{
 invoer.innerHTML+=`<label>${f[1]}</label><input id="${f[0]}">`;
});
invoer.innerHTML+=`
<button class="main" id="saveBtn">Opslaan</button>
<button class="main" id="scanBtn" style="background:#007bff">ðŸ“· Scan productieblad</button>
<input type="file" id="scanInput" accept="image/*" capture="environment" style="display:none">
`;

// Opslaan
document.getElementById("saveBtn").onclick=async()=>{
 let data={};
 fields.forEach(f=>{
  let v=document.getElementById(f[0]).value.trim();
  if(f[0]!=="omschrijving") v=v.toUpperCase();
  data[f[0]]=v;
 });
 if(editId) await colRef.doc(editId).set(data);
 else await colRef.add(data);
 alert("Opgeslagen");
};

// Scan
document.getElementById("scanBtn").onclick=()=>{
 document.getElementById("scanInput").click();
};

document.getElementById("scanInput").addEventListener("change",async e=>{
 const file=e.target.files[0];
 if(!file) return;
 alert("Scan bezig...");
 const {data:{text}}=await Tesseract.recognize(file,"eng");
 vulVelden(text);
});

function set(id,val){if(val)document.getElementById(id).value=val}
function vind(label,t){
 const m=t.match(new RegExp(label+"[:\\s]*([^\\n]+)","i"));
 return m?m[1].trim():"";
}

function vulVelden(t){
 const art=t.match(/Art\\.?\\s*Nr\\.?\\s*(\\d+)/i);
 if(art)set("artikelnummer",art[1]);

 const oms=t.match(/\\d+\\s+([A-Za-z].+)/);
 if(oms)set("omschrijving",oms[1]);

 set("deksel",vind("DEKSEL",t));
 set("blik",vind("BLIK",t));
 set("secundaireFolie",vind("SECUNDAIR",t));
 set("tertiaireFolie",vind("TERTIAIR",t));
 set("tertiaireTopfolie",vind("TOPFOL",t));
 set("pallet",vind("PALLET",t));
 set("tussenlegger",vind("TUSSENLEGGER",t));

 const lagen=t.match(/(\\d+)\\s*Lagen/i);
 if(lagen)set("aantalLagen",lagen[1]);

 const perlaag=t.match(/(\\d+)\\s*\\/\\s*Laag/i);
 if(perlaag)set("hoeveelPerLaag",perlaag[1]);
}

// Zoek tab
document.getElementById("zoekTab").innerHTML=`
<label>Zoek op artikelnummer of omschrijving</label>
<input id="zoek">
<button class="main" id="zoekBtn">Zoek</button>
<div id="result"></div>`;

document.getElementById("zoekBtn").onclick=async()=>{
 const q=document.getElementById("zoek").value.toUpperCase();
 const res=document.getElementById("result");
 res.innerHTML="";
 const snap=await colRef.get();
 snap.forEach(d=>{
  const data=d.data();
  if((data.artikelnummer||"").includes(q)||(data.omschrijving||"").includes(q)){
   let html=`<div class="result-card"><div class="omschrijving">${data.omschrijving||""}</div><hr>`;
   fields.forEach(f=>{
    if(f[0]!=="omschrijving"&&data[f[0]])html+=`<b>${f[1]}:</b> ${data[f[0]]}<br>`;
   });
   html+="</div>";
   res.innerHTML+=html;
  }
 });
};

// Tabs
const tabInvoer=document.getElementById("tabInvoer");
const tabZoek=document.getElementById("tabZoek");
const invoerTab=document.getElementById("invoerTab");
const zoekTab=document.getElementById("zoekTab");

tabInvoer.onclick=()=>{tabInvoer.classList.add("active");tabZoek.classList.remove("active");invoerTab.style.display="block";zoekTab.style.display="none"}
tabZoek.onclick=()=>{tabZoek.classList.add("active");tabInvoer.classList.remove("active");invoerTab.style.display="none";zoekTab.style.display="block"}
</script>
</body>
</html>